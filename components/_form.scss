@import 'button';

$form-with-border: true !default;
$form-field-selector: '.form-field' !default;
$form-field-with-errors: '.with-errors' !default;
$form-field-error-selector: '.error' !default;
$form-select-selector: '.form-select' !default;
$form-multi-select-selector: '.form-multi-select' !default;
$form-submission-with-confirm: '.with-confirm' !default;

$form-confirm-border-color: transparentize($white, .65) !default;
$form-input-background: linear-gradient(bottom, transparent, rgba($black, .03)) !default;
$form-input-background-color: $white !default;
$form-input-border-color: darken($white, 10%) !default;
$form-input-border-color-focused: $smoke !default;
$form-input-disabled-bg: rgba(255, 255, 255, 0) !default;
$form-input-height: $button-small-height !default;
$form-input-padding: $form-input-height - $base-font-size !default;
$form-input-shadow-color: rgba($black, .08) !default;
$form-input-text-color: $small-font-color !default;
$form-input-disabled-text-color: lighten($form-input-text-color, 20%) !default;
$form-label-height: $form-input-height;
$form-select-arrow-size: 4px !default;
$form-select-background: linear-gradient(top, transparent, rgba($black, .03)) !default;

$include-html-paint-form: true !default;

$form-input-icon-color: $iron !default;
$form-input-icon-size: 15px !default;
$form-input-option-color: $monsoon !default;
$form-input-item-border: 0 !default;
$form-input-item-background: $jet !default;
$form-input-item-color: $white !default;
$form-input-option-focused-background: $primary-color !default;
$form-input-option-focused-color: $white !default;
$form-input-dropdown-icon: plus !default;
$form-input-menu-max-height: 200px !default;

@mixin form($with-border: $form-with-border) {
  @extend %grid-column-12;

  padding: 0 !important;

  @if $with-border {
    background-color: lighten($panel-bg, 2%);
    border: solid 1px $global-section-border-color;
    border-radius: $global-radius;
  }
}

@mixin form-fieldset($with-border: $form-with-border) {
  border: 0;
  margin-bottom: 0;

  @if $with-border {
    padding: $column-gutter / 2 $column-gutter / 2 0;
  } @else {
    padding: 0;
  }

  &:not(:last-of-type) {
    border-bottom: 1px solid $global-section-border-color;
  }

  legend {
    display: none;
  }
}

@mixin form-field() {
  min-height: $form-input-height * 3;

  &#{$form-field-with-errors} {
    #{$form-field-error-selector} {
      color: $alert-color;
      font-size: $small-font-size;
      line-height: $form-input-height / 2;
      padding-left: $column-gutter / 2;
    }

    input,
    textarea,
    &#{$form-select-selector} > div {
      @include single-transition(border-color, 150ms, linear);

      border-color: lighten($alert-color, 10%);
    }
  }
}

@mixin form-label() {
  font-size: $h5-font-size;
  font-weight: $font-weight-bold;
  line-height: $form-label-height;
  min-height: $form-label-height;
}

@mixin form-input() {
  @include form-input-shared-properties;

  font-size: $base-font-size;
  line-height: $form-input-height;
  margin-bottom: 0;
  padding: 0 $form-input-padding / 2;

  &::-webkit-input-placeholder {
    color: lighten($form-input-text-color, 20%);
  }
}

@mixin form-select($inner-wrapper: '.content', $inline: false) {
  @if ($inner-wrapper == null) {
    $inner-wrapper: '&';
  }

  #{$inner-wrapper} {
    @include form-input-shared-properties;
    @include form-select-arrow;

    background: $white;
    background-image: $form-select-background !important;
    line-height: $form-input-height;
    overflow: hidden;
    position: relative;

    @if $inline {
      float: left;
      padding-right: $column-gutter;
    }

    select {
      -webkit-appearance: none;
      background: rgba($black, 0);
      border: 0;
      border-radius: $global-radius;
      color: $form-input-text-color;
      font-size: $base-font-size;
      margin: 0;
      padding: 0 $form-input-padding / 2;
      position: relative;
      text-shadow: 0 1px $white;
      width: 130%;

      &:focus {
        color: $anchor-font-color;
        outline: none;
        width: 100%;
        z-index: 1;
      }

      > option {
        background: darken($white, 10%);
        border-radius: $global-radius;
        cursor: pointer;
        margin: 3px;
        padding: 3px 8px;
        text-shadow: none;
      }
    }
  }

  &.disabled,
  &.disabled #{$inner-wrapper} {
    &,
    select {
      @include form-input-disabled;
    }
  }
}

@mixin form-multi-select() {
  position: relative;

  .content {
    &:not(.is-open) > .menu-outer {
      display: none;
    }

    &.is-searchable.is-open > .control {
      cursor: text;
    }

    &.is-searchable.is-focused:not(.is-open) > .control {
      cursor: text;
    }

    &.is-open > .control {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      border-color: $form-input-border-color-focused;

      > .arrow {
        @if $form-input-dropdown-icon == arrow {
          border-color: transparent transparent $primary-color;
          border-width: 0 $form-select-arrow-size $form-select-arrow-size;
        }
      }
    }

    .control {
      @include form-input;
      @include form-input-shared-properties;


      background-color: $form-input-background-color;
      position: relative;
      transition: border-color 200ms ease;
    }

    &.is-focused .control,
    &.is-focused .menu-outer {
      border-color: $form-input-border-color-focused;
    }

    &.is-multi .input {
      border: 1px solid transparent;
      color: $black;
      vertical-align: middle;
    }

    .option {
      border-bottom: 1px solid $form-input-border-color;
      box-sizing: border-box;
      color: $form-input-option-color;
      cursor: pointer;
      display: block;
      font-size: $small-font-size;
      padding: $form-input-height / 2 - $base-font-size / 2 $column-gutter / 2  $form-input-height / 2 - $base-font-size / 2  $column-gutter / 2;
      width: 101%;

      &:last-child {
        border: 0;
      }
    }

    .input {
      display: block;
      width: auto;

      > input {
        -webkit-appearance: none;
        background: none !important;
        border: 0 !important;
        box-shadow: none !important;
        cursor: default;
        display: inline-block;
        font-family: inherit;
        line-height: $form-input-height;
        margin: 0;
        outline: none;
        padding: 0 !important;
        width: 100%;
      }
    }

    &.is-focused .input > input {
      cursor: text;
    }

    &.has-value > .control {
      padding-bottom: $base-font-size / 2;
      padding-top: $base-font-size / 2;

      > .loading {
        right: $column-gutter;
      }
    }

    &.is-open .input {
      display: block;
      width: 100%;
    }

    .control:not(.is-searchable) > .input {
      outline: none;
    }

    .loading {
      animation: spin 400ms infinite linear;
      border: 2px solid #cccccc;
      border-radius: 50%;
      border-right-color: #333333;
      box-sizing: border-box;
      display: inline-block;
      height: $form-input-icon-size;
      margin-top: -$form-input-icon-size / 2;
      position: relative;
      right: $column-gutter;
      top: 50%;
      width: $form-input-icon-size;
    }

    .items {
      margin:$column-gutter / 3 0;

      .item {
        background-color: $form-input-item-background;
        border: $form-input-item-border;
        border-radius: $global-radius;
        color: $form-input-item-color;
        display: inline-block;
        font-size: $small-font-size;
        margin: $column-gutter / 5;
        padding: 0;
        position: relative;
        transition: color 300ms ease;

        &:hover {
          .item-label {
            padding: 0 20px 0 10px;
          }

          .item-icon {
            display: block;
          }
        }
      }
    }

    .item-icon,
    .item-label {
      vertical-align: middle;
    }

    .item-label {
      cursor: default;
      display: block;
      line-height: $form-input-icon-size * 2;
      padding: 0 15px;
      transition: padding 300ms ease;
      text-shadow: none;
    }

    .item-icon {
      @include icon(times);

      cursor: pointer;
      display: none;
      height: $form-input-icon-size * 2;
      line-height: $form-input-icon-size * 2;
      position: absolute;
      right: -$form-input-icon-size * 1000;
      transition: color 300ms ease-in;
      width: $form-input-icon-size;

      &:hover {
        color: $alert-color;
      }

      &:before {
        font-size: $small-font-size;
        left: -$form-input-icon-size * 1000;
        line-height: $form-input-icon-size * 2;
        position: absolute;
      }
    }

    .clear {
      @include button-icon(trash-o);

      color: $form-input-icon-color;
      cursor: pointer;
      height: $form-input-height;
      line-height: $form-input-height;
      position: absolute;
      right: $form-input-icon-size;
      margin: $column-gutter / 4  $column-gutter / 2;
      text-align: center;
      top: 0;

      &:hover {
        color: lighten($alert-color, 7%);
      }

      > span {
        font-size: 1.1em;
      }
    }

    .arrow {
      @include button-icon($form-input-dropdown-icon);

      color: $form-input-icon-color;
      content: ' ';
      cursor: pointer;
      margin: $column-gutter / 4  0;
      position: absolute;
      right: 0;
      top: 0;
      text-align: center;

      &:hover {
        color: $info-color;
      }
    }

    .menu-outer {
      background-color: $white;
      border: 1px solid;
      border-color: $form-input-border-color;
      border-radius: 0 0 $global-radius $global-radius;
      box-shadow: 0 1px 0 rgba(0, 0, 0, .06);
      box-sizing: border-box;
      margin-top: -1px;
      margin-bottom: $column-gutter / 2;
      max-height: $form-input-menu-max-height;
      -webkit-overflow-scrolling: touch;
      top: 100%;
      width: 100%;
      z-index: 1000;

      ul {
        margin: 0;
        padding: 0;
      }
    }

    .menu {
      max-height: $form-input-menu-max-height;
      overflow-x: hidden;
      overflow-y: auto;
    }

    .option:last-child {
      border-radius: 0 0 $global-radius $global-radius;
    }

    .option.is-focused,
    .option:hover {
      background-color: $form-input-option-focused-background;
      color: $form-input-option-focused-color;
      transition: background .3s ease;

      &:last-child {
        margin-bottom: -1px;
      }
    }

    .noresults {
      box-sizing: border-box;
      color: $iron;
      cursor: default;
      display: block;
      line-height: $form-input-height;
      padding-right: $column-gutter / 3;
    }
  }
}

@mixin form-textarea() {
  @include form-input-shared-properties;

  font-size: $base-font-size;
  line-height: $base-line-height;
  min-height: $form-input-height * 3;
  padding: $form-input-padding / 2;
}

@mixin form-submission($with-border: $form-with-border, $with-confirm: true) {
  @extend %grid-column-12;
  @include single-transition(background-color, 150ms, linear);

  background-color: $white;
  border-top: 1px solid $global-section-border-color;

  @if $with-border {
    border-bottom-left-radius: $global-radius;
    border-bottom-right-radius: $global-radius;
    padding: $column-gutter !important;
  } @else {
    padding: $column-gutter $column-gutter / 2 !important;
  }

  @if $with-confirm {
    &#{$form-submission-with-confirm} {
      background-color: lighten($alert-color, 0%);
      color: $white;
      text-align: right;

      span {
        float: left;
        line-height: 100%;
        padding: $column-gutter / 2 0;
      }

      button {
        background-color: transparent;
        border: solid 1px $form-confirm-border-color;
        color: $white;

        &:hover {
          background-color: $form-confirm-border-color;
        }
      }

      a {
        color: $white;
      }
    }
  }

  button {
    @include single-transition(background-color, 150ms, linear);

    margin-bottom: 0 !important;

    &[type='submit'] {
      @extend %button-primary;

      &:disabled {
        @include button-disabled;
      }
    }

    &:not([type='submit']) {
      padding: $column-gutter / 2;
    }
  }

  a {
    color: $small-font-color;
    display: inline-block;
    padding: 0 $column-gutter;

    &:hover {
      color: $body-font-color;
    }
  }
}

@mixin form-select-arrow() {
  &:before,
  &:after {
    border: $form-select-arrow-size dashed;
    border-color: $small-font-color transparent;
    content: '';
    height: 0;
    pointer-events: none;
    position: absolute;
    right: $form-input-padding / 2;
    top: ($form-input-padding + $form-select-arrow-size) / 2;
    width: 0;
    z-index: 1;
  }

  &:before {
    border-bottom-style: solid;
    border-top: 0;
  }

  &:after {
    border-bottom: 0;
    border-top-style: solid;
    margin-top: $form-select-arrow-size * 2;
  }
}

@mixin form-input-disabled() {
  background-color: $form-input-disabled-bg;
  cursor: not-allowed;
  color: $form-input-disabled-text-color;
}

@mixin form-input-shared-properties() {
  background-image: $form-input-background;
  border: 1px solid;
  border-color: $form-input-border-color darken($form-input-border-color, 5%);
  border-radius: $global-radius;
  box-shadow: 0 1px 1px $form-input-shadow-color;
  color: $form-input-text-color;
  height: auto;
  text-shadow: 0 1px $white;

  &:hover {
    box-shadow: 0 1px 2px rgba($black, .1);
  }

  &:focus {
    background-color: $white;
    background-image: none;
  }

  &:disabled,
  &[disabled],
  &[readonly] {
    @include form-input-disabled;
  }
}

@mixin form-item-small() {
  @extend %grid-column-medium-6;
  @extend %grid-column-large-4;
}

@mixin form-item-medium() {
  @extend %grid-column-medium-6;
  @extend %grid-column-large-6;
}

@mixin form-item-large() {
  @extend %grid-column-medium-12;
  @extend %grid-column-large-12;
}

@include exports('paint-form') {
  @if $include-html-paint-form {
    .form form {
      @include form;

      .form-fieldset {
        @include form-fieldset;

        .form-field {
          @include form-field;

          label {
            @include form-label;
          }

          input {
            @include form-input;
          }

          &.form-select {
            @include form-select;
          }

          textarea {
            @include form-textarea;
          }
        }
      }
    }

    &.form-multi-select {
      @include form-multi-select;
    }

    .form-submission {
      @include form-submission;
    }
  }
}
